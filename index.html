<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modbus RTU/RS-485 Dashboard</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
        <div class="navbar-left">
            <button class="sidebar-toggle" id="sidebarToggle">
                <span class="toggle-icon">â˜°</span>
            </button>
            <div class="navbar-logo">
                <img src="main_logo.jpg" alt="Logo" class="navbar-logo-img">
            </div>
            <div class="navbar-title">EC-FAN Controller</div>
        </div>
        <div class="navbar-right">
            <div class="navbar-stats" id="navbarStats">
                <div class="navbar-stat-item" title="Total Requests">
                    <span class="navbar-stat-label">REQ</span>
                    <span class="navbar-stat-value" id="navStatRequests">0</span>
                </div>
                <div class="navbar-stat-item" title="Successful Responses">
                    <span class="navbar-stat-label">OK</span>
                    <span class="navbar-stat-value" id="navStatSuccess">0</span>
                </div>
                <div class="navbar-stat-item" title="Error Count">
                    <span class="navbar-stat-label">ERR</span>
                    <span class="navbar-stat-value" id="navStatErrors">0</span>
                </div>
                <div class="navbar-stat-item" title="Success Rate">
                    <span class="navbar-stat-label">RATE</span>
                    <span class="navbar-stat-value" id="navStatRate">0%</span>
                </div>
                <div class="navbar-stat-item" title="Errors per N frames">
                    <span class="navbar-stat-label">ERR/N</span>
                    <span class="navbar-stat-value" id="navStatErrorRate">0</span>
                </div>

                <!-- Detailed Stats Tooltip -->
                <div class="navbar-stats-tooltip" id="navbarStatsTooltip">
                    <div class="stats-tooltip-header">Communication Statistics</div>
                    <div class="stats-tooltip-row">
                        <span class="stats-tooltip-label">Total Requests:</span>
                        <span class="stats-tooltip-value" id="tooltipRequests">0</span>
                    </div>
                    <div class="stats-tooltip-row">
                        <span class="stats-tooltip-label">Successful:</span>
                        <span class="stats-tooltip-value" id="tooltipSuccess">0</span>
                    </div>
                    <div class="stats-tooltip-row">
                        <span class="stats-tooltip-label">Errors:</span>
                        <span class="stats-tooltip-value" id="tooltipErrors">0</span>
                    </div>
                    <div class="stats-tooltip-row">
                        <span class="stats-tooltip-label">Success Rate:</span>
                        <span class="stats-tooltip-value" id="tooltipRate">0%</span>
                    </div>
                    <div class="stats-tooltip-divider"></div>
                    <div class="stats-tooltip-row">
                        <span class="stats-tooltip-label">Error Rate:</span>
                        <span class="stats-tooltip-value">
                            <span id="tooltipErrorRate">0</span> errors per <span id="tooltipBaseFrames">1000</span> frames
                        </span>
                    </div>
                    <div class="stats-tooltip-divider"></div>
                    <div class="stats-tooltip-header" style="font-size: 12px; margin-top: 5px;">Per Device Stats</div>
                    <div id="deviceStatsContainer" class="device-stats-container">
                        <p style="color: #6c757d; font-size: 11px;">No device data yet</p>
                    </div>
                </div>
            </div>
            <div class="navbar-connection">
                <span id="navbar-status-indicator" class="navbar-status-indicator status-disconnected"></span>
                <span id="navbar-status-text" class="navbar-status-text">Disconnected</span>
            </div>
            <button class="monitor-toggle-btn" id="monitorToggleBtn" title="Communication Monitor">
                <span class="monitor-toggle-icon">ğŸ“¡</span>
                <span class="monitor-toggle-text">Monitor</span>
            </button>
        </div>
    </nav>

    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <nav class="sidebar-menu">
                <!-- Serial Port Menu Item -->
                <div class="menu-item-expandable" id="serialPortMenu">
                    <div class="menu-item-header">
                        <span class="menu-item-icon">ğŸ”Œ</span>
                        <span class="menu-item-text">Serial Port</span>
                        <span class="menu-item-arrow">â–¼</span>
                    </div>
                    <div class="menu-item-content">
                        <div class="sidebar-form-group">
                            <label for="sidebar-baudRate">Baud Rate</label>
                            <select id="sidebar-baudRate">
                                <option value="9600">9600</option>
                                <option value="19200">19200</option>
                                <option value="38400">38400</option>
                                <option value="57600">57600</option>
                                <option value="115200">115200</option>
                            </select>
                        </div>
                        <div class="sidebar-form-row">
                            <div class="sidebar-form-group">
                                <label for="sidebar-parity">Parity</label>
                                <select id="sidebar-parity">
                                    <option value="none" selected>None</option>
                                    <option value="even">Even</option>
                                    <option value="odd">Odd</option>
                                </select>
                            </div>
                            <div class="sidebar-form-group">
                                <label for="sidebar-dataBits">Data</label>
                                <select id="sidebar-dataBits">
                                    <option value="7">7</option>
                                    <option value="8" selected>8</option>
                                </select>
                            </div>
                            <div class="sidebar-form-group">
                                <label for="sidebar-stopBits">Stop</label>
                                <select id="sidebar-stopBits">
                                    <option value="1" selected>1</option>
                                    <option value="2">2</option>
                                </select>
                            </div>
                        </div>
                        <div class="sidebar-button-group">
                            <button id="sidebar-connectBtn" class="btn btn-primary btn-block">Connect</button>
                            <button id="sidebar-disconnectBtn" class="btn btn-secondary btn-block" disabled>Disconnect</button>
                        </div>
                    </div>
                </div>
                <div class="menu-item active" data-page="dashboard">
                    <span class="menu-item-icon">ğŸ“±</span>
                    <span class="menu-item-text">Dashboard</span>
                </div>
                <div class="menu-item" data-page="device-setup">
                    <span class="menu-item-icon">âš™ï¸</span>
                    <span class="menu-item-text">Device</span>
                </div>
                <div class="menu-item" data-page="modbus">
                    <span class="menu-item-icon">ğŸ“¡</span>
                    <span class="menu-item-text">Modbus</span>
                </div>
                <div class="menu-item" data-page="parameters">
                    <span class="menu-item-icon">ğŸ“‹</span>
                    <span class="menu-item-text">Parameters</span>
                </div>
                <div class="menu-item" data-page="firmware">
                    <span class="menu-item-icon">ğŸ“¥</span>
                    <span class="menu-item-text">Update</span>
                </div>
                <div class="menu-item" data-page="chart">
                    <span class="menu-item-icon">ğŸ“ˆ</span>
                    <span class="menu-item-text">Chart</span>
                </div>
            </nav>

            <!-- Settings Button at Bottom -->
            <div class="sidebar-footer">
                <button class="sidebar-settings-btn" id="openSettingsBtn">
                    <span class="settings-icon">âš™ï¸</span>
                    <span class="settings-text">Settings</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">

                <!-- Dashboard Page (Product Test) -->
                <div id="page-dashboard" class="page-content active">
                    <!-- Dashboard Header -->
                    <div class="dashboard-header">
                        <div class="dashboard-title-section">
                            <h1>Product Test Dashboard</h1>
                            <p class="dashboard-subtitle">ì—°ê²°ëœ ì œí’ˆë“¤ì„ ê°œë³„ ë˜ëŠ” ì¼ê´„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤</p>
                        </div>
                        <div class="dashboard-actions">
                            <button id="addDeviceBtn" class="btn btn-primary">
                                <span>+</span> Add Device
                            </button>
                            <button id="autoAssignIdBtn" class="btn btn-info">
                                <span>âš¡</span> Auto Assign IDs
                            </button>
                            <button id="refreshAllBtn" class="btn btn-secondary">
                                <span>â†»</span> Refresh All
                            </button>
                        </div>
                    </div>

                    <!-- All Device Control Section (same style as Device List) -->
                    <section class="device-list-section all-device-control-section">
                        <div class="section-header">
                            <div class="section-header-left">
                                <h3>All Device Control</h3>
                                <span class="device-count-badge selection-badge" id="selectedDeviceCount">0ê°œ ì„ íƒ</span>
                                <div class="selected-devices-chips" id="selectedDevicesChips"></div>
                            </div>
                            <div class="section-header-right">
                                <button id="selectAllDevices" class="btn btn-sm btn-outline">ì „ì²´ ì„ íƒ</button>
                                <button id="deselectAllDevices" class="btn btn-sm btn-outline">ì„ íƒ í•´ì œ</button>
                            </div>
                        </div>
                        <div class="all-device-control-content">
                            <div class="all-device-control-row">
                                <div class="all-device-control-item">
                                    <label>Setpoint</label>
                                    <div class="all-device-setpoint-wrapper">
                                        <input type="number" id="allDeviceSetpoint" min="0" max="10000" value="0" class="all-device-setpoint-input">
                                        <span class="all-device-setpoint-unit" id="allDeviceSetpointUnit">RPM</span>
                                        <input type="range" id="allDeviceSetpointSlider" min="0" max="10000" value="0" class="all-device-setpoint-slider">
                                    </div>
                                </div>
                                <div class="all-device-control-item">
                                    <label>ëª¨ë“œ</label>
                                    <div class="all-device-mode-toggle">
                                        <button class="mode-btn active" data-mode="0" id="allDeviceModeRpm">RPM</button>
                                        <button class="mode-btn" data-mode="1" id="allDeviceModePct">%</button>
                                    </div>
                                </div>
                                <div class="all-device-control-item all-device-control-actions">
                                    <label>&nbsp;</label>
                                    <div class="all-device-action-btns">
                                        <button id="allDeviceApplyBtn" class="btn btn-success" disabled>
                                            <span>â–¶</span> ì ìš©
                                        </button>
                                        <button id="allDeviceStopBtn" class="btn btn-danger" disabled>
                                            <span>â– </span> ì •ì§€
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Device List Section -->
                    <section class="device-list-section">
                        <div class="section-header">
                            <div class="section-header-left">
                                <h3>Device List</h3>
                                <span class="device-count-badge" id="totalDeviceCount">0ê°œ</span>
                            </div>
                            <div class="section-header-right">
                                <div class="view-mode-toggle">
                                    <button class="view-mode-btn" data-view="card" id="viewModeCard" title="ì¹´ë“œí˜• ë³´ê¸°">
                                        <span>â–¦</span>
                                    </button>
                                    <button class="view-mode-btn active" data-view="list" id="viewModeList" title="ëª©ë¡í˜• ë³´ê¸°">
                                        <span>â˜°</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="device-grid" id="deviceGrid">
                            <!-- Device cards will be dynamically added here -->
                            <div class="device-placeholder" id="devicePlaceholder">
                                <div class="placeholder-icon">ğŸ“¦</div>
                                <p>ë“±ë¡ëœ ì¶•ì´ ì—†ìŠµë‹ˆë‹¤</p>
                                <p class="placeholder-hint">"Add Device" ë²„íŠ¼ì„ ëˆŒëŸ¬ í…ŒìŠ¤íŠ¸í•  ì œí’ˆì„ ë“±ë¡í•˜ì„¸ìš”</p>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Device Setup Page -->
                <div id="page-device-setup" class="page-content">
                    <div style="height: 100%; display: flex; align-items: flex-start; justify-content: center; padding: 40px 20px;">
                        <div style="display: flex; width: 100%; max-width: 1400px; height: fit-content; max-height: calc(100vh - 180px); overflow: hidden; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); background: white;">
                        <!-- Left: Device List -->
                        <div style="width: 240px; background: #fafafa; border-right: 1px solid #e5e5e5; padding: 20px 12px; display: flex; flex-direction: column; overflow: hidden; flex-shrink: 0;">
                            <h3 style="margin-bottom: 15px; color: #404040; font-size: 12px; font-weight: 600; letter-spacing: 0.8px; text-transform: uppercase; flex-shrink: 0;">Devices</h3>
                            <div id="deviceSetupList" style="flex: 1; overflow-y: auto; display: flex; flex-direction: column;">
                                <div style="text-align: center; padding: 60px 15px; color: #6c757d;">
                                    <div style="font-size: 42px; margin-bottom: 10px;">ğŸ“¦</div>
                                    <p style="font-size: 13px; line-height: 1.5;">ë“±ë¡ëœ ë””ë°”ì´ìŠ¤ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                                    <p style="font-size: 11px; margin-top: 8px; color: #999;">Dashboardì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì¶”ê°€í•˜ì„¸ìš”</p>
                                </div>
                            </div>
                        </div>

                        <!-- Right: Tab Content -->
                        <div style="flex: 1; display: flex; flex-direction: column; overflow: hidden; max-width: 900px; background: white;">
                            <!-- Tab Buttons -->
                            <div style="display: flex; gap: 4px; background: white; padding: 24px 40px 0 40px; border-bottom: 1px solid #e5e5e5; flex-shrink: 0;">
                                <button class="device-setup-tab active" data-tab="configuration" style="padding: 10px 16px; border: none; border-bottom: 2px solid #1a1a1a; background: transparent; cursor: pointer; font-size: 14px; font-weight: 500; color: #1a1a1a; transition: all 0.2s;">
                                    Configuration
                                </button>
                                <button class="device-setup-tab" data-tab="parameters" style="padding: 10px 16px; border: none; border-bottom: 2px solid transparent; background: transparent; cursor: pointer; font-size: 14px; font-weight: 500; color: #6c757d; transition: all 0.2s;">
                                    Parameters
                                </button>
                            </div>

                            <!-- Configuration Tab Content -->
                            <div class="device-setup-tab-content active" id="deviceSetupConfigTab" style="flex: 1; overflow-y: auto; padding: 32px 40px; display: block; background: white;">
                                <div id="deviceSetupConfig">
                                    <div style="text-align: center; padding: 80px 20px; color: #6c757d;">
                                        <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;">ğŸ”§</div>
                                        <p style="font-size: 15px; font-weight: 500; color: #404040;">ë””ë°”ì´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                                        <p style="font-size: 13px; margin-top: 6px; color: #999;">ì™¼ìª½ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì„ íƒí•˜ë©´ ì„¤ì •ì„ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                                    </div>
                                </div>
                            </div>

                            <!-- Parameters Tab Content -->
                            <div class="device-setup-tab-content" id="deviceSetupParamsTab" style="flex: 1; overflow-y: auto; padding: 32px 40px; display: none; background: white;">
                                <div id="deviceSetupParams">
                                    <div style="text-align: center; padding: 80px 20px; color: #6c757d;">
                                        <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.3;">ğŸ“‹</div>
                                        <p style="font-size: 15px; font-weight: 500; color: #404040;">ë””ë°”ì´ìŠ¤ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
                                        <p style="font-size: 13px; margin-top: 6px; color: #999;">ì™¼ìª½ì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ì„ íƒí•˜ë©´ íŒŒë¼ë¯¸í„°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

                <!-- Modbus Page (formerly Dashboard) -->
                <div id="page-modbus" class="page-content">
                    <div class="content-grid">
                        <!-- Left Column -->
                        <div class="left-column">

                            <!-- Modbus Configuration -->
                            <section class="card">
                                <h2>Modbus Configuration</h2>
                                <div class="modbus-config">
                                    <div class="form-group">
                                        <label for="slaveId">Slave ID</label>
                                        <input type="text" id="slaveId" value="1" placeholder="1 or D">
                                        <small class="input-converted" id="slaveId-converted"></small>
                                    </div>
                                    <div class="form-group">
                                        <label for="functionCode">Function Code</label>
                                        <select id="functionCode">
                                            <option value="1">01 - Read Coils</option>
                                            <option value="2">02 - Read Discrete Inputs</option>
                                            <option value="3" selected>03 - Read Holding Registers</option>
                                            <option value="4">04 - Read Input Registers</option>
                                            <option value="5">05 - Write Single Coil</option>
                                            <option value="6">06 - Write Single Register</option>
                                            <option value="15">15 - Write Multiple Coils</option>
                                            <option value="16">16 - Write Multiple Registers</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="startAddress">Start Address</label>
                                        <input type="text" id="startAddress" value="0" placeholder="0 or D011">
                                        <small class="input-converted" id="startAddress-converted"></small>
                                    </div>
                                    <div class="form-group">
                                        <label for="quantity">Quantity</label>
                                        <input type="text" id="quantity" value="10" placeholder="10 or A">
                                        <small class="input-converted" id="quantity-converted"></small>
                                    </div>
                                    <div class="form-group" id="writeValueGroup" style="display: none;">
                                        <label for="writeValue">Write Value</label>
                                        <input type="text" id="writeValue" value="0" placeholder="0 or 3E8">
                                        <small class="input-converted" id="writeValue-converted"></small>
                                    </div>
                                </div>
                                <div class="button-group">
                                    <button id="sendBtn" class="btn btn-success" disabled>Send Request</button>
                                </div>
                            </section>

                        </div>
                    </div>
                </div>

                <!-- Parameters Page -->
                <div id="page-parameters" class="page-content">
                    <section class="card">
                        <!-- Device Selector (Collapsible) -->
                        <div class="param-device-selector">
                            <div class="param-device-selector-header" id="paramDeviceSelectorHeader">
                                <div class="param-device-header-left">
                                    <span class="param-device-toggle-icon" id="paramDeviceToggleIcon">â–¼</span>
                                    <span class="param-device-label">Target Device:</span>
                                    <span class="param-device-selected" id="paramDeviceSelectedName">ì„ íƒ ì•ˆë¨</span>
                                </div>
                                <button id="paramReadAllBtn" class="btn btn-success btn-sm" disabled>ğŸ“– Read All</button>
                            </div>
                            <div class="param-device-radio-group" id="paramDeviceRadioGroup">
                                <div class="param-device-placeholder">
                                    <span>ğŸ“¦</span> Dashboardì—ì„œ ë””ë°”ì´ìŠ¤ë¥¼ ë“±ë¡í•˜ì„¸ìš”
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-shrink: 0;">
                            <h2 style="margin-bottom: 0;">Parameter List</h2>
                            <div style="display: flex; gap: 10px; align-items: center;">
                                <div class="csv-import-group">
                                    <input type="file" id="csvFileInput" accept=".csv" style="display: none;">
                                    <button id="importCsvBtn" class="btn btn-secondary btn-sm">ğŸ“¥ Import CSV</button>
                                    <button id="exportCsvBtn" class="btn btn-secondary btn-sm">ğŸ“¤ Export CSV</button>
                                    <button id="loadDefaultCsvBtn" class="btn btn-info btn-sm">ğŸ“‹ Load Default</button>
                                </div>
                                <button id="addParamBtn" class="btn btn-primary btn-sm">+ Add Parameter</button>
                            </div>
                        </div>
                        <div class="param-filter-group" style="margin-bottom: 15px; display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
                            <div style="display: flex; gap: 5px;">
                                <button class="filter-btn active" data-filter="all">All</button>
                                <button class="filter-btn" data-filter="holding">Holding</button>
                                <button class="filter-btn" data-filter="input">Input</button>
                            </div>
                            <div style="display: flex; gap: 5px;">
                                <button class="filter-btn" data-implemented="all">All Status</button>
                                <button class="filter-btn" data-implemented="Y">Implemented</button>
                                <button class="filter-btn" data-implemented="N">Not Implemented</button>
                            </div>
                            <input type="text" id="paramSearchInput" placeholder="Search by name or address..." style="flex: 1; min-width: 200px; padding: 6px 10px; border: 1px solid #ced4da; border-radius: 4px; font-size: 13px;">
                            <span id="paramCount" style="color: #6c757d; font-size: 13px;">0 parameters</span>
                        </div>
                        <div id="paramList" class="param-list">
                            <p class="placeholder">No parameters defined. Click "Import CSV" or "Load Default" to load parameters.</p>
                        </div>
                    </section>
                </div>

                <!-- Settings Page (removed, now using modal) -->
                <div id="page-settings" class="page-content" style="display:none;">
                    <div class="settings-container">
                        <!-- Statistics Settings Section -->
                        <section class="card setting-section" id="setting-statistics" style="display: none;">
                            <h2>Statistics Settings</h2>
                            <p style="color: #6c757d; margin-bottom: 20px;">
                                í†µê³„ ê³„ì‚° ë° í‘œì‹œ ë°©ë²•ì„ ì„¤ì •í•©ë‹ˆë‹¤.
                            </p>
                            <div class="form-group" style="max-width: 400px;">
                                <label for="baseFrameCount">ê¸°ì¤€ í”„ë ˆì„ ìˆ˜ (Error Rate ê³„ì‚°)</label>
                                <input type="number" id="baseFrameCount" min="100" max="10000" value="1000" step="100">
                                <small style="color: #6c757d; margin-top: 5px; display: block;">
                                    ì—ëŸ¬ìœ¨ì„ ê³„ì‚°í•  ë•Œ ì‚¬ìš©í•  ê¸°ì¤€ í”„ë ˆì„ ìˆ˜ì…ë‹ˆë‹¤. ì˜ˆ: 1000 í”„ë ˆì„ë‹¹ ëª‡ ê°œì˜ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ì§€ ê³„ì‚°í•©ë‹ˆë‹¤.
                                </small>
                            </div>
                        </section>

                        <!-- Simulator Settings Section -->
                        <section class="card setting-section" id="setting-simulator" style="display: none;">
                            <h2>Virtual Slave Simulator</h2>
                            <p style="color: #6c757d; margin-bottom: 20px;">
                                ì‹¤ì œ Modbus ì¥ë¹„ ì—†ì´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ê°€ìƒ ìŠ¬ë ˆì´ë¸Œ ì¥ì¹˜ì…ë‹ˆë‹¤.
                                ì‹œë®¬ë ˆì´í„°ë¥¼ í™œì„±í™”í•˜ë©´ ì‹¤ì œ ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì—†ì´ Modbus í†µì‹ ì„ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                            </p>

                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                                <div>
                                    <div class="form-group">
                                        <label>ì‹œë®¬ë ˆì´í„° ìƒíƒœ</label>
                                        <div style="display: flex; align-items: center; gap: 10px;">
                                            <button id="simToggleBtn" class="btn btn-primary">ì‹œë®¬ë ˆì´í„° í™œì„±í™”</button>
                                            <span id="simStatus" style="color: #6c757d;">ë¹„í™œì„±</span>
                                        </div>
                                    </div>

                                    <div class="form-group">
                                        <label for="simSlaveId">ê°€ìƒ Slave ID</label>
                                        <input type="number" id="simSlaveId" min="1" max="247" value="1">
                                    </div>

                                    <div class="form-group">
                                        <label for="simDelay">ì‘ë‹µ ì§€ì—° (ms)</label>
                                        <input type="number" id="simDelay" min="0" max="1000" value="50" step="10">
                                    </div>

                                    <button id="simResetBtn" class="btn btn-warning">ë©”ëª¨ë¦¬ ì´ˆê¸°í™”</button>
                                </div>

                                <div>
                                    <h3 style="font-size: 14px; margin-bottom: 10px; color: #495057;">ì‹œë®¬ë ˆì´ì…˜ ë°ì´í„°</h3>
                                    <div style="background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 12px;">
                                        <div style="margin-bottom: 10px;">
                                            <strong>Holding Registers:</strong><br>
                                            [0] ì˜¨ë„: <span id="simTemp">--</span><br>
                                            [1] ìŠµë„: <span id="simHumid">--</span><br>
                                            [2] ì••ë ¥: <span id="simPress">--</span><br>
                                            [3] ì „ì••: <span id="simVolt">--</span><br>
                                            [5] ì†ë„: <span id="simSpeed">--</span> RPM
                                        </div>
                                        <div>
                                            <strong>Coils:</strong><br>
                                            [0] ì‹œìŠ¤í…œ ë™ì‘: <span id="simCoil0">--</span><br>
                                            [1] ì•ŒëŒ: <span id="simCoil1">--</span><br>
                                            [2] ì¤€ë¹„: <span id="simCoil2">--</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div style="background: #e7f3ff; padding: 15px; border-radius: 4px; border-left: 4px solid #007bff;">
                                <strong>ì‚¬ìš© ë°©ë²•:</strong>
                                <ol style="margin: 10px 0 0 20px; color: #495057;">
                                    <li>ì‹œë®¬ë ˆì´í„°ë¥¼ í™œì„±í™”í•©ë‹ˆë‹¤</li>
                                    <li>Dashboardë¡œ ëŒì•„ê°€ì„œ "Connect" ëŒ€ì‹  ê°€ìƒ ì—°ê²°ì„ ì‚¬ìš©í•©ë‹ˆë‹¤</li>
                                    <li>ì¼ë°˜ Modbus ëª…ë ¹ì„ ì „ì†¡í•˜ë©´ ì‹œë®¬ë ˆì´í„°ê°€ ì‘ë‹µí•©ë‹ˆë‹¤</li>
                                    <li>ë°ì´í„°ëŠ” ì‹¤ì‹œê°„ìœ¼ë¡œ ë³€í™”í•˜ì—¬ ì‹¤ì œ ì¥ë¹„ë¥¼ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤</li>
                                </ol>
                            </div>
                        </section>

                        <!-- External Tools Section -->
                        <section class="card setting-section" id="setting-external" style="display: none;">
                            <h2>ì™¸ë¶€ ì‹œë®¬ë ˆì´í„° ì‚¬ìš©</h2>
                            <p style="color: #6c757d; margin-bottom: 15px;">
                                ë” ì •êµí•œ í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ì™¸ë¶€ Modbus ì‹œë®¬ë ˆì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
                            </p>
                            <div style="background: #f8f9fa; padding: 15px; border-radius: 4px;">
                                <h3 style="font-size: 14px; margin-bottom: 10px;">ì¶”ì²œ í”„ë¡œê·¸ë¨:</h3>
                                <ul style="margin-left: 20px; color: #495057;">
                                    <li><strong>Modbus Poll / Slave</strong> - ê°€ì¥ ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” ìƒìš© í”„ë¡œê·¸ë¨</li>
                                    <li><strong>pyModSlave</strong> - ë¬´ë£Œ Python ê¸°ë°˜ ì‹œë®¬ë ˆì´í„°</li>
                                    <li><strong>com0com + Virtual Serial Port</strong> - ê°€ìƒ ì‹œë¦¬ì–¼ í¬íŠ¸ ìŒ ìƒì„±</li>
                                    <li><strong>ModRSsim2</strong> - ë¬´ë£Œ Modbus RTU/TCP ì‹œë®¬ë ˆì´í„°</li>
                                </ul>
                            </div>
                        </section>
                    </div>
                </div>

                <!-- Firmware Page -->
                <div id="page-firmware" class="page-content">
                    <div class="firmware-container">
                        <div class="firmware-header">
                            <h2>Firmware Download</h2>
                            <p class="firmware-subtitle">Modbus Function Code 0x66ì„ ì‚¬ìš©í•˜ì—¬ ì¥ì¹˜ì— íŒì›¨ì–´ë¥¼ ì—…ë¡œë“œí•©ë‹ˆë‹¤</p>
                        </div>

                        <!-- File Upload Section -->
                        <div class="firmware-upload-section">
                            <div class="firmware-dropzone" id="firmwareDropzone">
                                <div class="dropzone-content">
                                    <div class="dropzone-icon">ğŸ“</div>
                                    <div class="dropzone-text">
                                        <p class="dropzone-main">íŒŒì¼ì„ ì—¬ê¸°ì— ë“œë˜ê·¸í•˜ê±°ë‚˜ í´ë¦­í•˜ì—¬ ì„ íƒí•˜ì„¸ìš”</p>
                                        <p class="dropzone-sub">ì§€ì› í˜•ì‹: .bin, .hex, .fw</p>
                                    </div>
                                    <input type="file" id="firmwareFileInput" accept=".bin,.hex,.fw" hidden>
                                    <button class="btn btn-primary" id="firmwareSelectBtn">íŒŒì¼ ì„ íƒ</button>
                                </div>
                            </div>
                        </div>

                        <!-- Selected File Info -->
                        <div class="firmware-file-info" id="firmwareFileInfo" style="display: none;">
                            <div class="file-info-header">
                                <span class="file-icon">ğŸ“„</span>
                                <div class="file-details">
                                    <span class="file-name" id="firmwareFileName">-</span>
                                    <span class="file-size" id="firmwareFileSize">-</span>
                                </div>
                                <button class="file-remove-btn" id="firmwareRemoveBtn" title="íŒŒì¼ ì œê±°">Ã—</button>
                            </div>
                        </div>

                        <!-- Device Selection -->
                        <div class="firmware-device-section">
                            <h3>ëŒ€ìƒ ì¥ì¹˜ ì„ íƒ</h3>
                            <div class="firmware-device-row">
                                <div class="firmware-device-list" id="firmwareDeviceList">
                                    <p class="placeholder">ì—°ê²°ëœ ì¥ì¹˜ê°€ ì—†ìŠµë‹ˆë‹¤</p>
                                </div>
                                <div class="firmware-slave-direct">
                                    <label for="firmwareSlaveId">Slave ID ì§ì ‘ ì…ë ¥:</label>
                                    <input type="number" id="firmwareSlaveId" min="1" max="247" value="1">
                                </div>
                            </div>
                        </div>

                        <!-- Protocol Settings -->
                        <div class="firmware-settings-section">
                            <h3>í”„ë¡œí† ì½œ ì„¤ì •</h3>
                            <div class="firmware-settings-grid">
                                <div class="form-group">
                                    <label for="fwPacketSize">íŒ¨í‚· í¬ê¸° (bytes)</label>
                                    <select id="fwPacketSize">
                                        <option value="32">32 bytes</option>
                                        <option value="60" selected>60 bytes (ê¶Œì¥)</option>
                                        <option value="64">64 bytes</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="fwPacketDelay">íŒ¨í‚· ê°„ê²© (ms)</label>
                                    <input type="number" id="fwPacketDelay" min="10" max="500" value="50">
                                </div>
                                <div class="form-group">
                                    <label for="fwResponseTimeout">ì‘ë‹µ ëŒ€ê¸° (ms)</label>
                                    <input type="number" id="fwResponseTimeout" min="100" max="5000" value="1000">
                                </div>
                            </div>
                        </div>

                        <!-- Update Step Indicators -->
                        <div class="firmware-steps-section" id="firmwareStepsSection">
                            <h3>ì—…ë°ì´íŠ¸ ë‹¨ê³„</h3>
                            <div class="firmware-steps">
                                <div class="firmware-step" id="fwStep0x90" data-step="0x90">
                                    <div class="step-indicator">
                                        <span class="step-number">1</span>
                                        <span class="step-status-icon"></span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">ì´ˆê¸°í™” (0x90)</div>
                                        <div class="step-desc">Flash Unlock, íŒŒì¼ í¬ê¸° ì „ì†¡</div>
                                    </div>
                                </div>
                                <div class="firmware-step" id="fwStep0x91" data-step="0x91">
                                    <div class="step-indicator">
                                        <span class="step-number">2</span>
                                        <span class="step-status-icon"></span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">Erase í™•ì¸ (0x91)</div>
                                        <div class="step-desc">Flash Erase ì™„ë£Œ í™•ì¸ (0x55555555)</div>
                                    </div>
                                </div>
                                <div class="firmware-step" id="fwStep0x03" data-step="0x03">
                                    <div class="step-indicator">
                                        <span class="step-number">3</span>
                                        <span class="step-status-icon"></span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">ë°ì´í„° ì „ì†¡ (0x03)</div>
                                        <div class="step-desc">íŒì›¨ì–´ ë°ì´í„° ì „ì†¡</div>
                                        <div class="step-progress" id="fwDataProgress">
                                            <div class="step-progress-bar">
                                                <div class="step-progress-fill" id="fwDataProgressFill"></div>
                                            </div>
                                            <div class="step-progress-details">
                                                <span class="step-progress-percent" id="fwDataProgressPercent">0%</span>
                                                <span class="step-progress-bytes" id="fwDataProgressBytes">0 / 0 bytes</span>
                                            </div>
                                            <div class="step-progress-stats">
                                                <span class="step-progress-packets" id="fwDataProgressPackets">íŒ¨í‚·: 0 / 0</span>
                                                <span class="step-progress-time" id="fwDataProgressTime">ë‚¨ì€ ì‹œê°„: --:--</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="firmware-step" id="fwStep0x99" data-step="0x99">
                                    <div class="step-indicator">
                                        <span class="step-number">4</span>
                                        <span class="step-status-icon"></span>
                                    </div>
                                    <div class="step-content">
                                        <div class="step-title">ì™„ë£Œ (0x99)</div>
                                        <div class="step-desc">Flash Lock, ì—…ë°ì´íŠ¸ ì™„ë£Œ</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Download Progress -->
                        <div class="firmware-progress-section" id="firmwareProgressSection" style="display: none;">
                            <h3>í†µì‹  ë¡œê·¸</h3>
                            <div class="progress-container">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="firmwareProgressBar" style="width: 0%"></div>
                                </div>
                                <div class="progress-info">
                                    <span class="progress-percent" id="firmwareProgressPercent">0%</span>
                                    <span class="progress-status" id="firmwareProgressStatus">ì¤€ë¹„ ì¤‘...</span>
                                </div>
                            </div>
                            <div class="progress-log" id="firmwareProgressLog"></div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="firmware-actions">
                            <button class="btn btn-secondary" id="firmwareVerifyBtn" disabled>íŒŒì¼ ê²€ì¦</button>
                            <button class="btn btn-primary" id="firmwareDownloadBtn" disabled>ë‹¤ìš´ë¡œë“œ ì‹œì‘</button>
                            <button class="btn btn-danger" id="firmwareCancelBtn" style="display: none;">ì·¨ì†Œ</button>
                        </div>
                    </div>
                </div>

                <!-- Chart Page -->
                <div id="page-chart" class="page-content">
                    <div class="chart-page-container">
                        <!-- Chart Header -->
                        <div class="chart-header">
                            <div class="chart-title-section">
                                <h1>Real-time Chart</h1>
                                <p class="chart-subtitle">4ì±„ë„ ì‹¤ì‹œê°„ ë°ì´í„° ëª¨ë‹ˆí„°ë§</p>
                            </div>
                            <div class="chart-header-actions">
                                <button id="chartExportCsvBtn" class="btn btn-secondary btn-sm" title="Export to CSV">
                                    <span>ğŸ“¥</span> CSV
                                </button>
                                <button id="chartExportPngBtn" class="btn btn-secondary btn-sm" title="Export to PNG">
                                    <span>ğŸ–¼</span> PNG
                                </button>
                            </div>
                        </div>

                        <!-- Mode & Control Panel -->
                        <div class="chart-control-panel">
                            <div class="chart-mode-section">
                                <label class="chart-section-label">Mode</label>
                                <div class="chart-mode-toggle">
                                    <button class="chart-mode-btn active" data-mode="continuous" id="chartModeContinuous">
                                        <span class="mode-icon">â–¶</span>
                                        <span>Continuous</span>
                                    </button>
                                    <button class="chart-mode-btn" data-mode="trigger" id="chartModeTrigger">
                                        <span class="mode-icon">âš¡</span>
                                        <span>Trigger</span>
                                    </button>
                                </div>
                            </div>

                            <div class="chart-action-section">
                                <button id="chartStartBtn" class="btn btn-success">
                                    <span>â–¶</span> Start
                                </button>
                                <button id="chartStopBtn" class="btn btn-danger" disabled>
                                    <span>â– </span> Stop
                                </button>
                                <button id="chartClearBtn" class="btn btn-warning">
                                    <span>â†º</span> Clear
                                </button>
                                <button id="chartPauseBtn" class="btn btn-secondary" disabled>
                                    <span>â¸</span> Pause
                                </button>
                            </div>

                            <div class="chart-settings-section">
                                <div class="chart-setting-item">
                                    <label for="chartTimeScale">Time Scale</label>
                                    <select id="chartTimeScale">
                                        <option value="1000">1s</option>
                                        <option value="2000">2s</option>
                                        <option value="5000" selected>5s</option>
                                        <option value="10000">10s</option>
                                        <option value="30000">30s</option>
                                        <option value="60000">1m</option>
                                    </select>
                                </div>
                                <div class="chart-setting-item">
                                    <label for="chartSampleRate">Sample Rate</label>
                                    <select id="chartSampleRate">
                                        <option value="50">50ms</option>
                                        <option value="100" selected>100ms</option>
                                        <option value="200">200ms</option>
                                        <option value="500">500ms</option>
                                        <option value="1000">1s</option>
                                    </select>
                                </div>
                                <div class="chart-setting-item">
                                    <label for="chartBufferSize">Buffer</label>
                                    <select id="chartBufferSize">
                                        <option value="500">500 pts</option>
                                        <option value="1000" selected>1000 pts</option>
                                        <option value="2000">2000 pts</option>
                                        <option value="5000">5000 pts</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Trigger Settings (shown only in trigger mode) -->
                        <div class="chart-trigger-panel" id="chartTriggerPanel" style="display: none;">
                            <div class="trigger-settings-row">
                                <div class="trigger-setting-item">
                                    <label for="triggerChannel">Trigger Channel</label>
                                    <select id="triggerChannel">
                                        <option value="0">CH1</option>
                                        <option value="1">CH2</option>
                                        <option value="2">CH3</option>
                                        <option value="3">CH4</option>
                                    </select>
                                </div>
                                <div class="trigger-setting-item">
                                    <label for="triggerEdge">Edge</label>
                                    <select id="triggerEdge">
                                        <option value="rising">Rising â†‘</option>
                                        <option value="falling">Falling â†“</option>
                                        <option value="both">Both â†•</option>
                                    </select>
                                </div>
                                <div class="trigger-setting-item">
                                    <label for="triggerLevel">Level</label>
                                    <input type="number" id="triggerLevel" value="500" min="0" max="65535">
                                </div>
                                <div class="trigger-setting-item">
                                    <label for="triggerPreSamples">Pre-trigger</label>
                                    <input type="number" id="triggerPreSamples" value="100" min="0" max="500">
                                </div>
                                <div class="trigger-setting-item">
                                    <label for="triggerPostSamples">Post-trigger</label>
                                    <input type="number" id="triggerPostSamples" value="400" min="100" max="2000">
                                </div>
                            </div>
                            <div class="trigger-status">
                                <span class="trigger-status-label">Status:</span>
                                <span class="trigger-status-value" id="triggerStatus">Waiting</span>
                            </div>
                        </div>

                        <!-- Channel Configuration -->
                        <div class="chart-channel-panel">
                            <div class="channel-config" data-channel="0">
                                <label class="channel-toggle">
                                    <input type="checkbox" id="chartCh1Enable" checked>
                                    <span class="channel-indicator" style="background: #3498db;"></span>
                                    <span class="channel-name">CH1</span>
                                </label>
                                <div class="channel-address">
                                    <label for="chartCh1Addr">Addr:</label>
                                    <input type="text" id="chartCh1Addr" value="0xD011" placeholder="0x0000">
                                </div>
                                <div class="channel-value">
                                    <span class="channel-current-label">Value:</span>
                                    <span class="channel-current-value" id="chartCh1Value">--</span>
                                </div>
                            </div>
                            <div class="channel-config" data-channel="1">
                                <label class="channel-toggle">
                                    <input type="checkbox" id="chartCh2Enable" checked>
                                    <span class="channel-indicator" style="background: #e74c3c;"></span>
                                    <span class="channel-name">CH2</span>
                                </label>
                                <div class="channel-address">
                                    <label for="chartCh2Addr">Addr:</label>
                                    <input type="text" id="chartCh2Addr" value="0xD001" placeholder="0x0000">
                                </div>
                                <div class="channel-value">
                                    <span class="channel-current-label">Value:</span>
                                    <span class="channel-current-value" id="chartCh2Value">--</span>
                                </div>
                            </div>
                            <div class="channel-config" data-channel="2">
                                <label class="channel-toggle">
                                    <input type="checkbox" id="chartCh3Enable">
                                    <span class="channel-indicator" style="background: #2ecc71;"></span>
                                    <span class="channel-name">CH3</span>
                                </label>
                                <div class="channel-address">
                                    <label for="chartCh3Addr">Addr:</label>
                                    <input type="text" id="chartCh3Addr" value="0x0000" placeholder="0x0000">
                                </div>
                                <div class="channel-value">
                                    <span class="channel-current-label">Value:</span>
                                    <span class="channel-current-value" id="chartCh3Value">--</span>
                                </div>
                            </div>
                            <div class="channel-config" data-channel="3">
                                <label class="channel-toggle">
                                    <input type="checkbox" id="chartCh4Enable">
                                    <span class="channel-indicator" style="background: #f39c12;"></span>
                                    <span class="channel-name">CH4</span>
                                </label>
                                <div class="channel-address">
                                    <label for="chartCh4Addr">Addr:</label>
                                    <input type="text" id="chartCh4Addr" value="0x0000" placeholder="0x0000">
                                </div>
                                <div class="channel-value">
                                    <span class="channel-current-label">Value:</span>
                                    <span class="channel-current-value" id="chartCh4Value">--</span>
                                </div>
                            </div>
                        </div>

                        <!-- Chart Canvas Container -->
                        <div class="chart-canvas-container" id="chartCanvasContainer">
                            <canvas id="mainChart"></canvas>
                            <!-- Cursor Info Overlay -->
                            <div class="chart-cursor-info" id="chartCursorInfo" style="display: none;">
                                <div class="cursor-time" id="cursorTime">--</div>
                                <div class="cursor-values" id="cursorValues"></div>
                            </div>
                            <!-- Zoom Controls -->
                            <div class="chart-zoom-controls">
                                <button class="zoom-btn" id="chartZoomIn" title="Zoom In">+</button>
                                <button class="zoom-btn" id="chartZoomOut" title="Zoom Out">âˆ’</button>
                                <button class="zoom-btn" id="chartZoomReset" title="Reset Zoom">â†º</button>
                                <button class="zoom-btn" id="chartAutoScale" title="Auto Scale Y">â¬Œ</button>
                            </div>
                            <!-- Chart Instructions -->
                            <div class="chart-instructions" id="chartInstructions">
                                <span>Wheel: Zoom Y</span>
                                <span>Drag: Pan</span>
                                <span>Double-click: Reset</span>
                            </div>
                        </div>

                        <!-- Chart Info Panel -->
                        <div class="chart-info-panel">
                            <div class="chart-stats">
                                <div class="chart-stat-item">
                                    <span class="stat-label">Samples:</span>
                                    <span class="stat-value" id="chartSampleCount">0</span>
                                </div>
                                <div class="chart-stat-item">
                                    <span class="stat-label">Time Range:</span>
                                    <span class="stat-value" id="chartTimeRange">0s</span>
                                </div>
                                <div class="chart-stat-item">
                                    <span class="stat-label">Status:</span>
                                    <span class="stat-value" id="chartStatus">Stopped</span>
                                </div>
                            </div>
                            <div class="chart-markers" id="chartMarkers">
                                <span class="markers-label">Markers:</span>
                                <span class="markers-info" id="markersInfo">No markers set (Click to add)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Slide Panel - Communication Monitor -->
        <aside class="monitor-panel" id="monitorPanel">
            <div class="monitor-resize-handle" id="monitorResizeHandle"></div>
            <div class="monitor-panel-header">
                <h3>Communication Monitor</h3>
                <div class="monitor-panel-controls">
                    <div class="format-toggle">
                        <button class="format-btn active" data-format="hex">HEX</button>
                        <button class="format-btn" data-format="dec">DEC</button>
                    </div>
                    <button class="monitor-panel-close" id="monitorPanelClose" title="Close">Ã—</button>
                </div>
            </div>
            <div class="monitor-panel-body">
                <div id="monitorDisplay" class="monitor-container">
                    <p class="placeholder">Waiting for communication...</p>
                </div>
                <!-- Scroll to bottom button -->
                <button class="monitor-scroll-btn" id="monitorScrollBtn" title="Scroll to bottom">
                    <span class="scroll-icon">â†“</span>
                    <span class="new-count" id="newMessageCount">0</span>
                </button>
            </div>
            <div class="monitor-panel-footer">
                <div class="monitor-footer-left">
                    <label class="auto-scroll-toggle">
                        <input type="checkbox" id="autoScrollToggle" checked>
                        <span>Auto Scroll</span>
                    </label>
                    <span class="monitor-entry-count" id="monitorEntryCount">0 packets</span>
                </div>
                <button id="clearBtn" class="btn btn-warning btn-sm">Clear Monitor</button>
            </div>
        </aside>
    </div>

    <!-- Add Parameter Modal -->
    <div id="addParamModal" class="modal">
        <div class="modal-content add-param-modal-content">
            <div class="modal-header">
                <h3>ğŸ“ ìƒˆ íŒŒë¼ë¯¸í„° ì¶”ê°€</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body add-param-modal-body">
                <div class="add-param-form-group">
                    <div class="add-param-label">
                        <span class="add-param-icon">ğŸ·ï¸</span>
                        <label for="paramName">íŒŒë¼ë¯¸í„° ì´ë¦„</label>
                    </div>
                    <input type="text" id="paramName" placeholder="ì˜ˆ: Temperature, Pressure, Speed...">
                    <small class="add-param-hint">ëª¨ë‹ˆí„°ë§í•  íŒŒë¼ë¯¸í„°ì˜ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</small>
                </div>
                <div class="add-param-form-group">
                    <div class="add-param-label">
                        <span class="add-param-icon">ğŸ“</span>
                        <label for="paramAddress">ë ˆì§€ìŠ¤í„° ì£¼ì†Œ</label>
                    </div>
                    <input type="number" id="paramAddress" min="0" max="65535" value="0" placeholder="0 ~ 65535">
                    <small class="add-param-hint">Modbus ë ˆì§€ìŠ¤í„° ì£¼ì†Œ (0 ~ 65535)</small>
                </div>
                <div class="add-param-form-group">
                    <div class="add-param-label">
                        <span class="add-param-icon">âš™ï¸</span>
                        <label for="paramFunction">Function Code</label>
                    </div>
                    <select id="paramFunction">
                        <option value="3">03 - Read Holding Registers (ì½ê¸°/ì“°ê¸° ê°€ëŠ¥)</option>
                        <option value="4">04 - Read Input Registers (ì½ê¸° ì „ìš©)</option>
                        <option value="1">01 - Read Coils (ë””ì§€í„¸ ì¶œë ¥)</option>
                        <option value="2">02 - Read Discrete Inputs (ë””ì§€í„¸ ì…ë ¥)</option>
                    </select>
                    <small class="add-param-hint">ë°ì´í„°ë¥¼ ì½ì–´ì˜¬ Modbus í•¨ìˆ˜ ì½”ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”</small>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelParamBtn" class="btn btn-secondary">ì·¨ì†Œ</button>
                <button id="saveParamBtn" class="btn btn-primary">ğŸ’¾ ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content settings-modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="modal-close" id="closeSettingsBtn">&times;</button>
            </div>
            <div class="modal-body settings-modal-body">
                <!-- Settings Sidebar -->
                <div class="settings-sidebar">
                    <div class="settings-menu-item active" data-setting="statistics">
                        <span class="settings-menu-icon">ğŸ“Š</span>
                        <span class="settings-menu-text">Statistics</span>
                    </div>
                    <div class="settings-menu-item" data-setting="autoscan">
                        <span class="settings-menu-icon">ğŸ”</span>
                        <span class="settings-menu-text">Auto Scan</span>
                    </div>
                    <div class="settings-menu-item" data-setting="simulator">
                        <span class="settings-menu-icon">ğŸ”§</span>
                        <span class="settings-menu-text">Simulator</span>
                    </div>
                    <div class="settings-menu-item" data-setting="polling">
                        <span class="settings-menu-icon">ğŸ”„</span>
                        <span class="settings-menu-text">Polling</span>
                    </div>
                </div>

                <!-- Settings Content -->
                <div class="settings-content">
                    <!-- Statistics Settings -->
                    <div class="settings-panel active" id="settings-statistics">
                        <h4>Statistics Settings</h4>
                        <p style="color: #6c757d; margin-bottom: 20px; font-size: 13px;">
                            í†µê³„ ê³„ì‚° ë° í‘œì‹œ ë°©ë²•ì„ ì„¤ì •í•©ë‹ˆë‹¤.
                        </p>
                        <div class="form-group">
                            <label for="modal-baseFrameCount">ê¸°ì¤€ í”„ë ˆì„ ìˆ˜ (Error Rate ê³„ì‚°)</label>
                            <input type="number" id="modal-baseFrameCount" min="100" max="10000" value="1000" step="100">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ì—ëŸ¬ìœ¨ì„ ê³„ì‚°í•  ë•Œ ì‚¬ìš©í•  ê¸°ì¤€ í”„ë ˆì„ ìˆ˜ì…ë‹ˆë‹¤. ì˜ˆ: 1000 í”„ë ˆì„ë‹¹ ëª‡ ê°œì˜ ì—ëŸ¬ê°€ ë°œìƒí•˜ëŠ”ì§€ ê³„ì‚°í•©ë‹ˆë‹¤.
                            </small>
                        </div>
                    </div>

                    <!-- Auto Scan Settings -->
                    <div class="settings-panel" id="settings-autoscan">
                        <h4>Auto Scan Settings</h4>
                        <p style="color: #6c757d; margin-bottom: 20px; font-size: 13px;">
                            ì‹œë¦¬ì–¼ í¬íŠ¸ ì—°ê²° ì‹œ ìë™ìœ¼ë¡œ ì¥ì¹˜ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤.
                        </p>

                        <div class="form-group">
                            <label>ìë™ íƒìƒ‰ ëª¨ë“œ</label>
                            <div class="toggle-switch-container">
                                <label class="toggle-switch">
                                    <input type="checkbox" id="autoScanEnabled">
                                    <span class="toggle-slider"></span>
                                </label>
                                <span id="autoScanStatus" class="toggle-status">ë¹„í™œì„±</span>
                            </div>
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                í™œì„±í™”í•˜ë©´ ì—°ê²° ì‹œ ìë™ìœ¼ë¡œ Slave IDë¥¼ ìˆœíšŒí•˜ë©° ì¥ì¹˜ë¥¼ íƒìƒ‰í•©ë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="form-group">
                            <label>íƒìƒ‰ ë²”ìœ„</label>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <div style="flex: 1;">
                                    <label for="scanRangeStart" style="font-size: 12px; color: #6c757d;">ì‹œì‘ ID</label>
                                    <input type="number" id="scanRangeStart" min="1" max="247" value="1">
                                </div>
                                <span style="padding-top: 20px;">~</span>
                                <div style="flex: 1;">
                                    <label for="scanRangeEnd" style="font-size: 12px; color: #6c757d;">ì¢…ë£Œ ID</label>
                                    <input type="number" id="scanRangeEnd" min="1" max="247" value="10">
                                </div>
                            </div>
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ë²”ìœ„ê°€ ë„“ì„ìˆ˜ë¡ íƒìƒ‰ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="scanTimeout">ì‘ë‹µ ëŒ€ê¸° ì‹œê°„ (ms)</label>
                            <input type="number" id="scanTimeout" min="50" max="2000" value="200" step="50">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ê° ì¥ì¹˜ì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ìµœëŒ€ ì‹œê°„ì…ë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="scanRegister">íƒìƒ‰ìš© ë ˆì§€ìŠ¤í„° ì£¼ì†Œ</label>
                            <input type="text" id="scanRegister" value="0xD011" placeholder="0xD011">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ì¥ì¹˜ ì¡´ì¬ í™•ì¸ì— ì‚¬ìš©í•  ë ˆì§€ìŠ¤í„° ì£¼ì†Œ (ê¸°ë³¸: Motor Status)
                            </small>
                        </div>

                        <div style="margin-top: 20px; display: flex; gap: 10px;">
                            <button id="manualScanBtn" class="btn btn-primary">
                                <span>ğŸ”</span> ìˆ˜ë™ íƒìƒ‰ ì‹œì‘
                            </button>
                            <button id="stopScanBtn" class="btn btn-secondary" disabled>
                                <span>â– </span> íƒìƒ‰ ì¤‘ì§€
                            </button>
                        </div>

                        <div id="scanProgress" style="display: none; margin-top: 20px;">
                            <div class="progress-bar-container">
                                <div class="progress-bar" id="scanProgressBar" style="width: 0%"></div>
                            </div>
                            <p id="scanProgressText" style="text-align: center; margin-top: 10px; color: #6c757d; font-size: 13px;"></p>
                        </div>

                        <div id="scanResults" style="display: none; margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 4px;">
                            <strong style="display: block; margin-bottom: 10px;">íƒìƒ‰ ê²°ê³¼:</strong>
                            <div id="scanResultsList" style="font-size: 13px;"></div>
                        </div>
                    </div>

                    <!-- Simulator Settings -->
                    <div class="settings-panel" id="settings-simulator">
                        <h4>Virtual Slave Simulator</h4>
                        <p style="color: #6c757d; margin-bottom: 20px; font-size: 13px;">
                            ì‹¤ì œ Modbus ì¥ë¹„ ì—†ì´ í…ŒìŠ¤íŠ¸í•  ìˆ˜ ìˆëŠ” ê°€ìƒ ìŠ¬ë ˆì´ë¸Œ ì¥ì¹˜ì…ë‹ˆë‹¤.
                        </p>

                        <div class="form-group">
                            <label>ì‹œë®¬ë ˆì´í„° ìƒíƒœ</label>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button id="modal-simToggleBtn" class="btn btn-success">Activate</button>
                                <span id="modal-simStatus" style="color: #6c757d;">ë¹„í™œì„±</span>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="modal-simSlaveId">ê°€ìƒ Slave ID</label>
                            <input type="number" id="modal-simSlaveId" min="1" max="247" value="1">
                        </div>

                        <div class="form-group">
                            <label for="modal-simDelay">ì‘ë‹µ ì§€ì—° (ms)</label>
                            <input type="number" id="modal-simDelay" min="0" max="1000" value="50" step="10">
                        </div>

                        <button id="modal-simResetBtn" class="btn btn-warning">ë©”ëª¨ë¦¬ ì´ˆê¸°í™”</button>

                        <div style="margin-top: 20px; background: #f8f9fa; padding: 15px; border-radius: 4px; font-family: 'Consolas', monospace; font-size: 12px;">
                            <div style="margin-bottom: 10px;">
                                <strong>Holding Registers:</strong><br>
                                [0] ì˜¨ë„: <span id="modal-simTemp">--</span><br>
                                [1] ìŠµë„: <span id="modal-simHumid">--</span><br>
                                [2] ì••ë ¥: <span id="modal-simPress">--</span><br>
                                [3] ì „ì••: <span id="modal-simVolt">--</span><br>
                                [5] ì†ë„: <span id="modal-simSpeed">--</span> RPM
                            </div>
                            <div>
                                <strong>Coils:</strong><br>
                                [0] ì‹œìŠ¤í…œ ë™ì‘: <span id="modal-simCoil0">--</span><br>
                                [1] ì•ŒëŒ: <span id="modal-simCoil1">--</span><br>
                                [2] ì¤€ë¹„: <span id="modal-simCoil2">--</span>
                            </div>
                        </div>
                    </div>

                    <!-- Polling Settings -->
                    <div class="settings-panel" id="settings-polling">
                        <h4>Polling Settings</h4>
                        <p style="color: #6c757d; margin-bottom: 20px; font-size: 13px;">
                            ë””ë°”ì´ìŠ¤ ëª¨ë‹ˆí„°ë§ í´ë§ ì†ë„ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
                        </p>

                        <div class="form-group">
                            <label for="pollingInterval">Polling Interval (ms)</label>
                            <input type="number" id="pollingInterval" min="10" max="5000" value="50" step="10">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ë””ë°”ì´ìŠ¤ ê°„ í´ë§ ê°„ê²©ì…ë‹ˆë‹¤. ê°’ì´ ì‘ì„ìˆ˜ë¡ ë¹ ë¥´ê²Œ ì—…ë°ì´íŠ¸ë˜ì§€ë§Œ í†µì‹  ë¶€í•˜ê°€ ì¦ê°€í•©ë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="pollingTimeout">Response Timeout (ms)</label>
                            <input type="number" id="pollingTimeout" min="50" max="5000" value="200" step="50">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ê° ë ˆì§€ìŠ¤í„° ì½ê¸° ìš”ì²­ì˜ ì‘ë‹µ ëŒ€ê¸° ì‹œê°„ì…ë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="form-group">
                            <label for="paramPollingDelay">Parameter Polling Delay (ms)</label>
                            <input type="number" id="paramPollingDelay" min="0" max="500" value="20" step="5">
                            <small style="color: #6c757d; margin-top: 5px; display: block;">
                                ëª¨ë‹ˆí„°ë§ íŒŒë¼ë¯¸í„° ê°„ ë”œë ˆì´ì…ë‹ˆë‹¤. í†µì‹  ì•ˆì •ì„±ì„ ìœ„í•´ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
                            </small>
                        </div>

                        <div class="form-group" style="margin-top: 15px; padding: 15px; background: #1a1a2e; border: 1px solid #2d2d4e; border-radius: 8px;">
                            <div style="display: flex; align-items: center; justify-content: space-between;">
                                <div>
                                    <label style="margin-bottom: 4px; display: block;">Background Polling</label>
                                    <small style="color: #6c757d; display: block;">
                                        ë¸Œë¼ìš°ì € ìµœì†Œí™” ì‹œì—ë„ í´ë§ ì†ë„ë¥¼ ìœ ì§€í•©ë‹ˆë‹¤. Web Worker íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•˜ì—¬ ë¸Œë¼ìš°ì € throttlingì„ ìš°íšŒí•©ë‹ˆë‹¤.
                                    </small>
                                </div>
                                <label class="toggle-switch" style="margin-left: 15px; flex-shrink: 0;">
                                    <input type="checkbox" id="backgroundPollingToggle">
                                    <span class="toggle-slider"></span>
                                </label>
                            </div>
                        </div>

                        <div style="margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 4px; font-size: 13px;">
                            <strong style="color: #007bff;">ğŸ’¡ ê¶Œì¥ ì„¤ì •</strong>
                            <ul style="margin: 10px 0 0 0; padding-left: 20px; color: #495057;">
                                <li><strong>ë¹ ë¥¸ ì‘ë‹µ:</strong> Interval 50ms, Timeout 200ms</li>
                                <li><strong>ì•ˆì •ì  í†µì‹ :</strong> Interval 200ms, Timeout 500ms</li>
                                <li><strong>ì €ë¶€í•˜ ëª¨ë“œ:</strong> Interval 500ms, Timeout 1000ms</li>
                            </ul>
                        </div>

                        <button id="applyPollingSettings" class="btn btn-primary" style="margin-top: 20px;">
                            Apply Settings
                        </button>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Add Device Modal -->
    <div id="addDeviceModal" class="modal">
        <div class="modal-content add-device-modal-content">
            <div class="modal-header">
                <h3>â• Add Device</h3>
                <button class="modal-close" id="closeDeviceModalBtn">&times;</button>
            </div>
            <div class="modal-body add-device-modal-body">
                <div class="add-device-form-group">
                    <div class="add-device-label">
                        <span class="add-device-icon">ğŸ·ï¸</span>
                        <label for="deviceName">Device Name</label>
                    </div>
                    <input type="text" id="deviceName" placeholder="e.g., Motor #1, Fan Unit A">
                </div>
                <div class="add-device-form-group">
                    <div class="add-device-label">
                        <span class="add-device-icon">ğŸ”¢</span>
                        <label for="deviceSlaveId">Slave ID</label>
                    </div>
                    <input type="number" id="deviceSlaveId" min="0" max="247" value="1">
                    <span class="add-device-hint">0 = ë¯¸ì„¤ì • (Auto Assignìœ¼ë¡œ ë‚˜ì¤‘ì— í• ë‹¹ ê°€ëŠ¥)</span>
                </div>
                <div class="add-device-form-group">
                    <div class="add-device-label">
                        <span class="add-device-icon">âš™ï¸</span>
                        <label for="deviceOperationMode">Default Operation Mode</label>
                    </div>
                    <select id="deviceOperationMode">
                        <option value="0">RPM Mode</option>
                        <option value="1">% Mode (Modulation)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelDeviceBtn" class="btn btn-secondary">Cancel</button>
                <button id="saveDeviceBtn" class="btn btn-primary">Add Device</button>
            </div>
        </div>
    </div>

    <!-- Auto Assign ID Modal -->
    <div id="autoAssignModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Auto Assign Node IDs</h3>
                <button class="modal-close" id="closeAutoAssignModalBtn">&times;</button>
            </div>
            <div class="modal-body">
                <div style="background: #fff3cd; padding: 15px; border-radius: 4px; margin-bottom: 20px; border-left: 4px solid #ffc107;">
                    <strong>ì•ˆë‚´:</strong>
                    <p style="margin: 10px 0 0 0; color: #856404;">
                        ì´ ê¸°ëŠ¥ì€ Slave IDê°€ 0ìœ¼ë¡œ ì„¤ì •ëœ ì œí’ˆë“¤ì—ê²Œ ìˆœì°¨ì ìœ¼ë¡œ IDë¥¼ í• ë‹¹í•©ë‹ˆë‹¤.<br>
                        ì œí’ˆì€ í•œ ëŒ€ì”© ì—°ê²°í•˜ì—¬ IDë¥¼ ì„¤ì •í•˜ê±°ë‚˜, Broadcast(ID=0)ë¥¼ ì‚¬ìš©í•˜ì—¬ í• ë‹¹í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                    </p>
                </div>
                <div class="form-group">
                    <label for="startingSlaveId">Starting Slave ID</label>
                    <input type="number" id="startingSlaveId" min="1" max="247" value="1">
                </div>
                <div class="form-group">
                    <label>í• ë‹¹ ë°©ë²•</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="assignMethod" value="sequential" checked>
                            <span>ìˆœì°¨ í• ë‹¹ (ì œí’ˆ ìˆœì„œëŒ€ë¡œ)</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="assignMethod" value="broadcast">
                            <span>Broadcast í• ë‹¹ (í•œ ëŒ€ì”© ì—°ê²° í•„ìš”)</span>
                        </label>
                    </div>
                </div>
                <div id="autoAssignProgress" style="display: none;">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="assignProgressBar" style="width: 0%"></div>
                    </div>
                    <p id="assignProgressText" style="text-align: center; margin-top: 10px; color: #6c757d;"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button id="cancelAutoAssignBtn" class="btn btn-secondary">Cancel</button>
                <button id="startAutoAssignBtn" class="btn btn-primary">Start Assignment</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <script src="modbus.js"></script>
    <script src="simulator.js"></script>
    <script src="app.js"></script>
</body>
</html>
